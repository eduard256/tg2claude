# Найти магнет-ссылку для фильма или любого другого торрента

## Описание
Freedomist API позволяет искать торренты по названию и получать magnet-ссылки для скачивания.

## Как использовать скрипты

### 1. Поиск торрентов
```bash
./scripts/freedomist-search.sh "название фильма/сериала" [лимит]
```

**Параметры:**
- `название` (обязательно) - поисковый запрос
- `лимит` (опционально, по умолчанию 20) - максимум результатов

**Пример:**
```bash
./scripts/freedomist-search.sh "matrix" 15
./scripts/freedomist-search.sh "breaking bad season 4" 20
```

**Формат ответа:**
```json
{
  "status": 200,
  "total": 15,
  "results": [
    {
      "title": "Название торрента",
      "tracker": "rutracker",
      "s": 273,        // seeders (сиды)
      "l": 10,         // leechers (личи)
      "size": "2.94 GB",
      "key": "abc123", // ключ для получения magnet-ссылки
      "dl": 94994      // downloads (скачивания)
    }
  ]
}
```

### 2. Получение magnet-ссылки
После выбора торрента используй скрипт с его `key`:
```bash
./scripts/freedomist-magnet.sh "KEY"
```

**Параметры:**
- `KEY` (обязательно) - значение поля `key` из результатов поиска

**Пример:**
```bash
./scripts/freedomist-magnet.sh "39843ec99caf91b7cef3"
```

**Формат ответа:**
```json
{
  "status": 200,
  "magnet": "magnet:?xt=urn:btih:B287AD8D8EB741623EABCA5A1E30171432037D36&tr=...",
  "tracker": "rutracker"
}
```

**Важно:** Оба скрипта автоматически берут токен из `keys/freedomist.json`, не нужно передавать его вручную.

## Критерии выбора лучшего торрента

### Приоритеты:
1. **Скорость скачивания** (главное):
   - Высокие `s` (seeders) - чем больше, тем быстрее
   - Низкие `l` (leechers) - чем меньше, тем быстрее
   - **Идеально**: `s` > 50 и `s` > `l`

2. **Популярность и надежность**:
   - Высокие `dl` (downloads) - проверенная раздача
   - Трекер `rutracker` обычно надежнее

3. **Размер файла**:
   - Зависит от требований пользователя
   - Меньше размер = быстрее скачается

### Примеры оценки:
- `s: 273, l: 10` → **ОТЛИЧНО** (быстро скачается)
- `s: 89, l: 3` → **ХОРОШО**
- `s: 24, l: 0` → **НОРМ** (мало сидов, но нет конкуренции)
- `s: 6, l: 46` → **ПЛОХО** (много желающих, мало раздающих)

## Правила работы с поисковыми запросами

### Если пользователь просит конкретный сезон:
- **"4 сезон"** → искать `"название season 4"` или `"название s04"`
- Выбирать ТОЛЬКО торренты с 4 сезоном, НЕ полные коллекции
- Если результат не содержит нужный сезон → **ПОВТОРИТЬ ПОИСК** с другим запросом

### Если пользователь просит диапазон сезонов:
- **"с 1 по 4 сезон"** → искать каждый сезон ОТДЕЛЬНО
- Лучше 4 отдельных торрента, чем 1 полная коллекция
- Отдельные сезоны скачиваются быстрее

### Если пользователь указывает качество:
- **"4к"** → искать `"2160p"` или `"4K"` или `"UHD"` в названии
- **"5.1"** (звук) → искать `"5.1"` или `"DTS"` или `"Dolby"` в названии
- **"4к + 5.1"** → фильтровать результаты, где в названии есть ОБА параметра

### Примеры поисковых запросов:
- Пользователь: "найди breaking bad 4 сезон"
  → `./scripts/freedomist-search.sh "breaking bad season 4"`

- Пользователь: "хочу Matrix в 4к с 5.1"
  → `./scripts/freedomist-search.sh "matrix 4k"` → проверить `title` на наличие "2160p" и "5.1"

- Пользователь: "сериал друзья с 1 по 3 сезон"
  → Сделать 3 поиска: `"friends season 1"`, `"friends season 2"`, `"friends season 3"`

## Важно!
- Если первый поиск не дал нужного результата → **делай повторный поиск** с другими ключевыми словами
- Всегда проверяй `title` результата на соответствие запросу пользователя
- Не выбирай полные коллекции, если нужен конкретный сезон
- Объясняй пользователю, почему выбран именно этот торрент (сиды, размер, качество)

## Структура API

### POST /search
Основной метод поиска.

**Параметры:**
- `query` - поисковый запрос
- `token` - токен доступа (берется из `keys/freedomist.json`)
- `limit` - максимум результатов (1-25, по умолчанию 20)
- `offset` - смещение для пагинации (по умолчанию 0)
- `trackers` - массив трекеров для фильтрации (опционально)
- `order_by` - сортировка: "d" (дата), "l" (личи), "s" (сиды), "t" (название), "r" (рейтинг), "z" (размер), "i" (индекс)

**Пример прямого вызова:**
```bash
TOKEN=$(jq -r .token keys/freedomist.json)
curl -sk -X POST "https://api.exfreedomist.com/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "matrix", "token": "'$TOKEN'", "limit": 20}'
```

### GET /magnet/{key}
Получение magnet-ссылки по ключу из результатов поиска.

**Параметры:**
- `key` (в URL) - значение `magnet_key` из результатов поиска
- `token` (query) - токен доступа

**Ответ:**
```json
{
  "data": {
    "magnet_link": "magnet:?xt=urn:btih:...",
    "topic_id": -1,
    "tracker": "rutracker",
    "rank": "0"
  },
  "message": "",
  "status_code": 200
}
```

## Workflow для ИИ

1. Пользователь просит найти торрент
2. **Анализируешь запрос**: выделяешь название, сезон/серию, качество
3. **Формируешь правильный поисковый запрос**
4. **Запускаешь скрипт**: `./scripts/freedomist-search.sh "запрос"`
5. **Анализируешь результаты**:
   - Проверяешь соответствие `title` требованиям
   - Оцениваешь метрики (s, l, size)
   - Выбираешь лучший вариант
6. **Если результат не подходит** → повторяешь с другим запросом
7. **Получаешь magnet-ссылку** по выбранному `key`
8. **Отвечаешь пользователю**: название, размер, сиды/личи, magnet-ссылка

### Пример полного workflow:
```
Пользователь: "Найди Breaking Bad 4 сезон в хорошем качестве"

1. Поиск:
   ./scripts/freedomist-search.sh "breaking bad season 4"

2. Анализ результатов:
   - "Breaking Bad Season 4 complete (2011) [1080p]" → s:7, l:0, 6.1GB
   - "Breaking Bad Season 4 Complete 720p" → s:246, l:90, 4.78GB

3. Выбор: второй вариант (246 сидов, значит скачается быстро)

4. Получение magnet:
   ./scripts/freedomist-magnet.sh "1a639e9f94dec82f305c"

5. Ответ пользователю:
   "Нашёл Breaking Bad 4 сезон (720p, 4.78 GB):
   246 сидов, 90 личей - скачается быстро
   Magnet: magnet:?xt=urn:btih:..."
```
